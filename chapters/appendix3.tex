% !TeX root = ../Thesis.tex

\begin{proof}
	Let us name the sequence as $\sigma = [i_1, j_1\rangle, \ldots, [i_k,
	j_k\rangle$. It not hard to see that $\sigma$ is a segmentation. First
	notice that $i$ and $j$ can only change their values to $\ell$ and $\ell +
	1$ in the execution, so as $ 0 \leq \ell \leq n$, then every span in
	$\sigma$ must be contained in the document. Now suppose that $k > 1$
	(otherwise $\sigma$ is trivially a segmentation). Pick any $1 \leq h < k$.
	Then Algorithm \ref*{alg:segmentation} adds the span $\sspan{i_h, j_h}$ in
	line 10 after an $\textbf{else if}$ statement that ensures that $j_h \leq
	\ell$ in that iteration. Rightly afterwards on line 11 $i$ starts holding
	the value $\ell + 1$, then $j_h < i$ right at the end of that iteration. So
	whenever the algorithm outputs $[i_{h+1}, j_{h+1}\rangle$ it is certain that
	$j_h < i_{h+1}$ because $i$ cannot decrease in value. 

    Let us prove now that $\sigma$ is a valid segmentation. Let $\mu \in
    \sem{\cA}_d$ be a mapping of $\cA$ over $d$. We must show that there exists
    $1 \leq h \leq k$ such that there is a mapping $\mu' \in
    \sem{\cA}(d\sspan{i_h, j_h})$ that satisfies $\mu = \mu'_{+h}$. As we have
    the mapping $\mu$ then there is an accepting run 
    $$
    \rho \ = \ (q_0, \iota_0) \ \trans{o_1} \ (q_1, \iota_1) \ \trans{o_2} \ \cdots \ \trans{o_m} \ (q_m, \iota_m)
    $$ 
    over $d$ that satisfies $q_m = q_f$ and such that the spans that $\mu$ holds
    are all contained inside the span $\sspan{\iota_0, \iota_m}$. We proceed to
    show that the span $\sspan{\iota_0, \iota_m}$ must be contained inside a
    span $\sspan{i_h, j_h}$ of $\sigma$. In Algorithm \ref{alg:segmentation},
    consider the iteration inside the loop when $\ell = \iota_0$. We can be sure
    that in the iteration the function $\texttt{next}_\delta(S, a_\ell)$ does
    not return \texttt{ends} as true, because we know that $\rho$ is accepting
    and it doesn't end at $\iota_0$. Therefore the variable $i$ does not change
    its value and it must satisfy that $i \leq \iota_0$ at the end of this
    iteration. The same argument can be made for the iterations that follow,
    namely when $\ell$ takes the values $\iota_1, \ldots, \iota_{m-1}$, the
    variable $i$ must satisfy $i \leq \iota_0$ at the end of each of these
    iterations. Now consider the iteration when $\ell = \iota_m$. It is clear
    that $\texttt{next}_\delta(S, a_\ell)$ will return \texttt{outputs} as true
    because $\rho$ is accepting. Hence, $j$ will change its value to $\iota_m +
    1$ in this iteration, Thus $j < \iota_m$. Given that the mapping $\mu$
    cannot contain a zero-length span (otherwise $\cA$ would not constitute a
    valid logical VA), then $i \leq \iota_0 < \iota_m \leq j$. In future
    iterations is easy to see that:
    \begin{enumerate}
        \item[(i)] the value of $j$ can only increase,
        \item[(ii)] the value of $i$ can cannot change before outputting a span,
        and
        \item[(iii)] the algorithm will eventually output a span $\sspan{i_h,
        j_h}$ that satisfies $i_h \leq \iota_0 < \iota_m \leq j_h$. 
    \end{enumerate}
    Therefore, $\sspan{\iota_0, \iota_m}$ is contained inside a span
    $\sspan{i_h, j_h}$ of $\sigma$. Now if we take the document $d\sspan{i_h,
    j_h}$ it must hold that there is a mapping $\mu' \sem{\cA}(d\sspan{i_h,
    j_h})$ defined by the accepting run 
    $$
    \rho' \ = \ (q_0, \iota_0-h) \ \trans{o_1} \ (q_1, \iota_1-h) \ \trans{o_2} \ \cdots \ \trans{o_m} \ (q_m, \iota_m-h)
    $$ 
    of $\cA$ over $d\sspan{i_h, j_h}$. Furthermore, it satisfies that $\mu =
    \mu'_{+h}$.

    The converse is straightforward. Let $\mu' \in \sem{\cA}(d\sspan{i_h, j_h})$
    be a mapping of $\cA$ over $d\sspan{i_h, j_h}$ for some $1 \leq h \leq k$.
    Therefore, there exists an accepting run
    $$
    \rho' \ = \ (q_0, \iota_0) \ \trans{o_1} \ (q_1, \iota_1) \ \trans{o_2} \ \cdots \ \trans{o_m} \ (q_f, \iota_m)
    $$
    of $\cA$ over $d\sspan{i_h, j_h}$. This means that it must exist an
    accepting run
    $$
    \rho \ = \ (q_0, \iota_0+h) \ \trans{o_1} \ (q_1, \iota_1+h) \ \trans{o_2} \ \cdots \ \trans{o_m} \ (q_f, \iota_m+h)
    $$
    of $\cA$ over $d$. It is straightforward that the mapping $\mu^\rho$ is the
    same mapping $\mu'$ with an offset, i.e. $\mu^\rho = \mu'_{+h}$. Thus,
    $\mu'_{+h} \in \sem{\cA}_d$. \qedhere 
    

\end{proof}