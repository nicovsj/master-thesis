\subsection{$\varepsilon$-logical VA}

An $\varepsilon$-logical VA is a logical VA extended with
$\varepsilon$-transitions. Formally, it is a tuple $\cA = (Q, \delta, q_0, q_f)$
defined in the same way as a logical VA, with the difference that the transition
relation $\delta$ now can additionally store $\varepsilon$-transitions of the
form $(q, \varepsilon, q')$ with $q, q' \in Q$.

Then, a run $\rho$ of an $\varepsilon$-logical VA $\cA$ over a document $d$ is
defined in in almost the exact same way as in a logical VA, with the
consideration that an $\varepsilon$-transition acts like an empty variable
marker; that is, (1) the automaton doesn't move on the document when an
$\varepsilon$-transition occurs, and (2) the mapping $\mu^\rho$ is not defined
in terms of the $\varepsilon$-transitions that occurred on $\rho$. The concepts
of accepting run and semantics over a document of an $\varepsilon$-logical VA
are defined in the same way as in a logical VA.

% Formally, a configuration of $\cA$ over
% $$
%   \rho \ = \ (q_0, i_0) \ \trans{o_1} \ (q_1, i_1) \ \trans{o_2} \ \cdots \
%   \trans{o_m} \ (q_m, i_m)
% $$
% where $(q_j, o_{j+1}, q_{j+1}) \in \delta$,  $i_0, \ldots, i_m$ is an
% increasing sequence, and $i_{j+1} = i_j +1$ if $o_{j+1}$ is a char class such
% that $a_{i_j} \in \cset(o_{j+1})$   (i.e.,\ the automaton moves one position
% in the document only when reading a letter) and $i_{j+1} = i_j$ otherwise. 


It not hard to see that an $\varepsilon$-logical VA $\cA$ can be build into a
logical VA $\cA'$ in linear time such that $\semd{\cA} = \semd{\cA'}$ for any
document $d$ iff $\varepsilon \notin \semd{\cA}$. We start by taking the
$\varepsilon$-closure for each state $q$ of $\cA$ (i.e., the set of states that
can be reached from $q$ by only traversing $\varepsilon$-transitions), and then
for each $(r, o, s) \in \delta$ such that $r$ is in the $\varepsilon$-closure of
$q$ and $o \neq \varepsilon$, we say that $(q, o, s)$ is in the new transition
relation $\delta'$. We then take the reverse $\varepsilon$-closure of $q_f$ (the
set of states that can reach $q_f$ by only traversing $\varepsilon$-transitions)
and, for each $(s, o, r) \in \delta$ such that $r$ is in the reverse
$\varepsilon$-closure of $q_f$ and $o \neq \varepsilon$, we say that $(s, o,
q_f)$ is in the new transition relation $\delta'$. Given that $\varepsilon
\notin \semd{\cA}$, we can be sure that the logical VA $\cA' = (Q, \delta', q_0,
q_f)$ satisfies $\semd{\cA} = \semd{\cA'}$ for any document $d$, given that
$q_f$ not being in the $\varepsilon$-closure of $q_0$ doesn't change
$\semd{\cA}$.


\subsection{Proof}

Let $\texttt{e}$ be a REQL. Then, $\varepsilon \notin \semd{\texttt{e}}$ for any
document $d$. We will show that there exists an $\varepsilon$-LogicalVA $\cA$
such that $\sem{\texttt{e}}_d = \sem{\cA}_d$ over any document $d$. Removing
$\varepsilon$-transitions from the Logical  We proceed by induction. For each of
the base cases shown in Table \ref*{tab-semantics} we can construct a LogicalVA
$\cA$ with two states, one initial and one accepting, and with a single
transition labeled as the char class equivalent to $\texttt{e}$ from the initial
state to the accepting state. Is easy to see that this LogicalVA $\cA$ satisfies
$\sem{\texttt{e}}_d = \sem{\cA}_d$ over any document $d$. 

The inductive case goes as follows: suppose that $\texttt{e}_1$ and
$\texttt{e}_2$ are two REQLs such that there exist $\cA_1 = (Q_1, \delta_1,
q_0^1, q_f^1)$ and $\cA_2 = (Q_2, \delta_2, q_0^2, q_f^2)$ both LogicalVAs that
satisfy $\sem{\texttt{e}_1}_d = \sem{\cA_1}_d$ and $\sem{\texttt{e}_2}_d =
\sem{\cA_2}_d$ over any document $d$. Then,

\begin{itemize}
	\item For $\texttt{e} = \texttt{e}_1\texttt{e}_2$ the LogicalVA $\cA = (Q_1
		      \cup Q_2, \delta_1 \cup \delta_2 \cup \{(q_f^1, \varepsilon,
		      q_0^2)\}, q_0^1, q_f^2)$ is such that over any document $d$,
		      $\sem{\texttt{e}}_d = \sem{\cA}_d$.
	\item For $\texttt{e} = \texttt{e}_1\texttt{|}\texttt{e}_2$ the LogicalVA
	      $\cA = (Q', \delta', q_0', q_f')$ with
	      \begin{align*}
		      Q'      & = Q_1 \cup Q_2 \cup \{q_0, q_f\}                                                                                                              \\
		      \delta' & = \delta_1 \cup \delta_2 \cup \{(q_0, \varepsilon, q_0^1), (q_0, \varepsilon, q_0^2), (q_f^1, \varepsilon, q_f), (q_f^2, \varepsilon, q_f) \} \\
		      q_0'    & = q_0                                                                                                                                         \\
		      q_f'    & = q_f
	      \end{align*}
	      is such that over any document $d$, $\sem{\texttt{e}}_d =
		      \sem{\cA}_d$.
	\item For $\texttt{e} = \texttt{!x\{}\texttt{e}_1\texttt{\}}$ the LogicalVA
	      $\cA$ is defined as
	      \[
		      \cA = (Q' \cup \{q_0, q_f\},\delta' \cup \{(q_0, [x, q_0'), (q_f', x\rangle, q_f)\}, q_0, q_f)
	      \]
	      such that over any document $d$, $\sem{\texttt{e}}_d =
		      \sem{\cA_\texttt{e}}_d$.
	\item For $\texttt{e} = \texttt{e}_1\texttt{*}$ the LogicalVA $\cA$ defined
	      as
	      \[
		      \cA = (Q_1 \cup \{q_0', q_f'\},
		      \delta_1 \cup \{(q_0', \varepsilon, q_0^1), (q_f^1, \varepsilon, q_0^1), (q_f^1, \varepsilon, q_f'), (q_0', \varepsilon, q_f')\},
		      q_0', q_f')
	      \]
	      is such that over any document $d$, $\sem{\texttt{e}}_d =
		      \sem{\cA}_d$.
	\item For $\texttt{e} = \texttt{e}_1\texttt{?}$ the LogicalVA $\cA$ defined
	as
	\[
		\cA = (Q_1 \cup \{q_0', q_f'\},
		\delta_1 \cup \{(q_0', \varepsilon, q_0^1), (q_f^1, \varepsilon, q_f'), (q_0', \varepsilon, q_f')\},
		q_0', q_f')
	\]
	is such that over any document $d$, $\sem{\texttt{e}}_d =
		\sem{\cA}_d$.
	\item For $\texttt{e} = \texttt{e}_1\texttt{+}$, we have that
	$\semd{\texttt{e}_1\texttt{+}} =
	\semd{\texttt{e}_1(\texttt{e}_1\texttt{*})}$ for any document $d$. This case
	is then inductive as it can be constructed from previous rules.
	\item For $\texttt{e} = \texttt{e}_1\texttt{\{n,m\}}$ we have that
	      $\sem{\texttt{e}}_d =
	      \sem{(\texttt{e}_1)^n(\texttt{e}_1\texttt{?})^{m-n}}_d$ for any
	      document $d$. This case is then inductive as it can be constructed
	      from previous rules.
\end{itemize}